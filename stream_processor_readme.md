Как это работает и что делает
Настройка: В CONFIG вы прописываете RTSP-адреса ваших камер и даете им короткие имена (cam_01, cam_02). Эти имена будут использоваться для создания папок.
Запуск: Скрипт запускается одной командой python 3_stream_processor.py.
Инициализация:
Создается общая очередь frame_queue для обмена данными.
Создается общий словарь cluster_db для хранения информации о кластерах.
Запускается один процесс frame_organizer. Он сразу же "засыпает", ожидая данных в очереди.
Запускается по одному процессу camera_stream_worker для каждой камеры из списка.
Работа Воркера (camera_stream_worker):
Подключается к своему RTSP-потоку. Если не получается, ждет и пробует снова.
В бесконечном цикле читает кадры.
Сравнивает текущий кадр с последним сохраненным кадром по метрике SSIM.
Если кадр достаточно отличается (произошло движение), он сохраняет его во временную папку (_temp/cam_01/) и кладет путь к файлу в frame_queue.
Работа Организатора (frame_organizer):
"Просыпается", как только в frame_queue появляется путь к новому кадру.
Вычисляет pHash этого кадра.
Смотрит в свою базу cluster_db: есть ли для этой камеры кластер с похожим pHash?
Если есть: Перемещает файл в папку этого кластера (/data/camera_captures/cam_01/cluster_005/).
Если нет: Создает новую папку (.../cluster_006/), добавляет pHash нового кадра в базу как "представителя" этого нового кластера и перемещает файл туда.
Результат: В вашей папке /data/camera_captures/ будут автоматически создаваться подпапки для каждой камеры. А внутри них — папки-кластеры (cluster_000, cluster_001 и т.д.), в которых будут сгруппированы изображения похожих сцен (например, "пустая комната днем", "пустая комната ночью", "человек в комнате" и т.д.), избавленные от тысяч абсолютно одинаковых кадров.